---
import { getCollection } from "astro:content";
import { TagIcon } from "@heroicons/react/24/outline/index.js";
import slugify from "../utils/slugify";
import ButtonContainer from "./ButtonContainer.astro";
import Button from "./Button.astro";

const allBlogPosts = await getCollection("blog", ({ data }) => !data.draft);
const tags = [...new Set(allBlogPosts.map((post) => post.data.tags).flat())];
const currentPage = Astro.url.pathname;

// Debug logging - remove after fixing
console.log("Current page:", currentPage);
console.log("Full URL:", Astro.url.href);
console.log("Pathname:", Astro.url.pathname);

// Helper function to normalize URLs for comparison
const normalizeUrl = (url: string) => url.endsWith('/') && url !== '/' ? url.slice(0, -1) : url;

const filters = [
    {
        url: "/blog",
        label: "All",
        selected: normalizeUrl("/blog") === normalizeUrl(currentPage),
    },
    ...tags.map((tag) => {
        const tagUrl = `/blog/tag/${slugify(tag)}`;
        return {
            url: tagUrl,
            label: tag,
            selected: normalizeUrl(tagUrl) === normalizeUrl(currentPage),
        };
    }),
];
---

<menu class="flex items-center gap-3 mb-6">
    <TagIcon className="w-6" />
    <ButtonContainer>
        {
            filters.map(({ url, label, selected }) => (
                <Button selected={selected} href={url} size="sm">
                    {label}
                </Button>
            ))
        }
    </ButtonContainer>
</menu>
